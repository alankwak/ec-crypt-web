<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Elliptic Curve Calculator</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">

    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script src="components/ecForm.js"></script>
    <script src="components/ecCayleyTable.js"></script>
    <script src="components/ecTranslationTool.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">Elliptic Curve Calculator</a>
        </div>
    </nav>

    <ec-ecform ></ec-ecform>

    <ec-translator></ec-translator>

    <ec-cayleytable></ec-cayleytable>

    <script>
        const ecInput = document.querySelector('ec-ecform');
        const ecTable = document.querySelector('ec-cayleytable');
        const ecTranslator = document.querySelector('ec-translator');
        document.addEventListener('create-new-curve', async e => {
            if(ecInput) {
                try {
                    const response = await fetch("/update-curve", {
                        method: "POST",
                        body: JSON.stringify({
                            a: ecInput.a,
                            b: ecInput.b,
                            mod: ecInput.mod
                        }),
                        headers: { "Content-Type": "application/json" }
                    });
                    if(response.ok) {
                        const ecInfo = await response.json();
                        if(ecTable) {
                            ecTable.setAttribute('ecinfo', JSON.stringify(ecInfo));
                        }
                    }
                } catch(err) {
                    console.log(`Error: ${err}`);
                }
            }
        });

        document.addEventListener('request-encrypt', async e => {
            try {
                const response = await fetch("/encrypt", {
                    method: "POST",
                    body: JSON.stringify({
                        a: ecInput.a,
                        b: ecInput.b,
                        mod: ecInput.mod,
                        msg: e.detail.msg
                    }),
                    headers: { "Content-Type": "application/json" }
                });
                if(response.ok) {
                    const res = await response.json();
                    if(ecTranslator) {
                        ecTranslator.setAttribute('output', res.encrypted_msg);
                    }
                }
            } catch(err) {
                console.log(`Error: ${err}`);
            }
        });

         document.addEventListener('request-decrypt', async e => {
            try {
                const response = await fetch("/decrypt", {
                    method: "POST",
                    body: JSON.stringify({
                        a: ecInput.a,
                        b: ecInput.b,
                        mod: ecInput.mod,
                        msg: e.detail.msg
                    }),
                    headers: { "Content-Type": "application/json" }
                });
                if(response.ok) {
                    const res = await response.json();
                    if(ecTranslator) {
                        ecTranslator.setAttribute('output', res.plaintext_msg);
                    }
                }
            } catch(err) {
                console.log(`Error: ${err}`);
            }
        });
    </script>
</body>
</html>